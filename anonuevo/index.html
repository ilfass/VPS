<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Viaje de ilfass - Acto Cero</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;600&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #fff;
            font-family: 'Outfit', sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Video de fondo sutil (simulado con gradiente animado por ahora) */
        .background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, #1e293b 0%, #000 70%);
            z-index: 1;
            opacity: 0.6;
        }

        .container {
            position: relative;
            z-index: 10;
            text-align: center;
            max-width: 800px;
            padding: 2rem;
        }

        /* Avatar */
        .avatar-container {
            width: 150px;
            height: 150px;
            margin: 0 auto 2rem;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 30px rgba(56, 189, 248, 0.2);
            animation: pulse 4s infinite ease-in-out;
        }

        .avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* Placeholder para la cara real */
            background: #334155;
        }

        /* Texto Manifiesto */
        .manifesto-text {
            font-size: 2rem;
            font-weight: 300;
            line-height: 1.4;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1s ease, transform 1s ease;
        }

        .manifesto-text.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .highlight {
            color: #38bdf8;
            font-weight: 600;
        }

        /* Barra de progreso / Tiempo */
        .progress-line {
            position: fixed;
            bottom: 0;
            left: 0;
            height: 4px;
            background: #38bdf8;
            width: 0%;
            transition: width 0.1s linear;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 20px rgba(56, 189, 248, 0.1);
            }

            50% {
                box-shadow: 0 0 40px rgba(56, 189, 248, 0.3);
            }

            100% {
                box-shadow: 0 0 20px rgba(56, 189, 248, 0.1);
            }
        }
    </style>
</head>

<body>
    <div class="background"></div>

    <div class="container">
        <div class="avatar-container">
            <!-- FOTO REAL -->
            <img src="avata-placeholder.png" class="avatar-img" alt="ilfass">
        </div>

        <div id="text-display" class="manifesto-text">
            Preparando conexi칩n...
        </div>
    </div>

    <div class="progress-line" id="progress"></div>

    <script>
        // Configuraci칩n de la IA de Voz (Hacker Mode Humanizado)
        const voiceConfig = {
            pitch: 1.0,
            rate: 1.0,
            volume: 1.0
        };

        // Guion del Acto Cero
        const script = [
            { text: "Esto no es un stream infinito.", delay: 500 },
            { text: "No es una web tradicional.", delay: 500 },
            { text: "Es un viaje global <span class='highlight'>en tiempo real</span>.", delay: 500 },
            { text: "Me llamo <span class='highlight'>ilfass</span>.", delay: 800 },
            { text: "Y voy a documentar el mundo,", delay: 500 },
            { text: "mientras escribimos juntos un <span class='highlight'>Libro Vivo</span>.", delay: 500 },
            { text: "Bienvenidos al viaje.", delay: 2000 }
        ];

        let currentIndex = 0;
        const textDisplay = document.getElementById('text-display');
        const progressBar = document.getElementById('progress');
        const avatarContainer = document.querySelector('.avatar-container');
        let availableVoices = [];

        function loadVoices() {
            availableVoices = window.speechSynthesis.getVoices();
            console.log("Voces:", availableVoices.map(v => v.name));
        }

        window.speechSynthesis.onvoiceschanged = () => {
            loadVoices();
        };

        function getBestVoice() {
            loadVoices();
            // 1. Prioridad: Voces "Google" o "Microsoft" expl칤citamente MASCULINAS en ESPA칌OL
            let best = availableVoices.find(v => v.lang.startsWith('es') && (v.name.includes('Google') || v.name.includes('Microsoft')) && (v.name.includes('Male') || v.name.includes('Pablo') || v.name.includes('Alvaro') || v.name.includes('Jorge')));

            // 2. Si no, cualquier voz masculina en espa침ol
            if (!best) best = availableVoices.find(v => v.lang.startsWith('es') && (v.name.includes('Male') || v.name.includes('Hombre')));

            // 3. Fallback: Google Espa침ol (suele ser mujer, la modularemos) o Microsoft
            if (!best) best = availableVoices.find(v => v.lang.startsWith('es') && (v.name.includes('Google') || v.name.includes('Microsoft')));

            // 4. 칔ltimo recurso
            if (!best) best = availableVoices.find(v => v.lang.startsWith('es'));

            return best;
        }

        function speak(text, callback) {
            window.speechSynthesis.cancel();

            const cleanText = text.replace(/<[^>]*>?/gm, '');
            const utterance = new SpeechSynthesisUtterance(cleanText);
            const voice = getBestVoice();

            if (voice) {
                utterance.voice = voice;

                // --- MODIFICACI칍N CLAVE: MASCULINIZACI칍N ---
                const isExplicitlyMale = voice.name.includes('Male') || voice.name.includes('Hombre') || voice.name.includes('Pablo') || voice.name.includes('Alvaro');

                if (!isExplicitlyMale) {
                    console.log("Usando voz femenina modulada:", voice.name);
                    // Bajamos el pitch para simular voz masculina en voces femeninas (ej: Google espa침ol)
                    utterance.pitch = 0.7;
                    utterance.rate = 0.95;
                } else {
                    console.log("Usando voz masculina natural:", voice.name);
                    utterance.pitch = 1.0;
                    utterance.rate = 1.0;
                }
            }

            // Sincronizaci칩n Visual (Avatar Lipsync Simulado)
            utterance.onstart = () => {
                avatarContainer.style.transition = "box-shadow 0.1s";
                avatarContainer.style.borderColor = "#38bdf8";
                avatarContainer.style.animation = "speaking 0.3s infinite alternate";
            };

            utterance.onend = () => {
                avatarContainer.style.animation = "pulse 4s infinite ease-in-out"; // Volver a idle
                avatarContainer.style.borderColor = "rgba(255, 255, 255, 0.1)";
                if (callback) callback();
            };

            utterance.onerror = (e) => {
                console.error("TTS Error", e);
                if (callback) callback();
            };

            window.speechSynthesis.speak(utterance);
        }

        function playNextLine() {
            if (currentIndex >= script.length) {
                textDisplay.innerHTML = "<span style='font-size: 1rem; color: #64748b;'>SISTEMA EN L칈NEA.</span>";
                progressBar.style.width = "100%";
                // Aqu칤 podr칤as redireccionar: window.location.href = '../portada/index.html';
                return;
            }

            const line = script[currentIndex];
            textDisplay.classList.remove('visible');

            setTimeout(() => {
                textDisplay.innerHTML = line.text;
                textDisplay.classList.add('visible');

                const progress = ((currentIndex + 1) / script.length) * 100;
                progressBar.style.width = `${progress}%`;

                speak(line.text, () => {
                    currentIndex++;
                    setTimeout(playNextLine, line.delay);
                });
            }, 500);
        }

        // Estilos extra para la animaci칩n de hablar
        const styleSheet = document.createElement("style");
        styleSheet.innerText = `
            @keyframes speaking {
                0% { box-shadow: 0 0 20px #38bdf8; transform: scale(1); }
                100% { box-shadow: 0 0 60px #38bdf8; transform: scale(1.02); }
            }
        `;
        document.head.appendChild(styleSheet);

        function init() {
            loadVoices();
            // Bot칩n Overlay Obligatorio para Audio
            const overlay = document.createElement('div');
            Object.assign(overlay.style, {
                position: 'fixed', top: 0, left: 0, width: '100%', height: '100%',
                background: '#000', zIndex: 1000, display: 'flex', flexDirection: 'column',
                justifyContent: 'center', alignItems: 'center', cursor: 'pointer'
            });

            overlay.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 20px;">游댉</div>
                <div style="border: 1px solid #38bdf8; padding: 15px 40px; color: #38bdf8; font-family: 'Outfit', sans-serif; letter-spacing: 2px; text-transform: uppercase; transition: all 0.3s;">
                    Iniciar Sistema
                </div>
            `;

            overlay.onclick = () => {
                overlay.style.opacity = 0;
                setTimeout(() => overlay.remove(), 500);
                // Warmup del motor de audio
                window.speechSynthesis.resume();
                playNextLine();
            };
            document.body.appendChild(overlay);
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>

</html>